async function calc() { const symbol = document.getElementById("stock").value; const growthInput = document.getElementById("growth").value; const growth = growthInput ? Number(growthInput) : 10; try { const response = await fetch(`/api/stock?symbol=${symbol}`); // Handle HTTP errors if (!response.ok) { throw new Error("Server error while fetching stock data"); } const data = await response.json(); // Backend returned logical error if (data.error) { alert(data.error); return; } // EPS missing (important for valuation) if (!data.eps || data.eps === 0) { alert("EPS data not available for this stock."); return; } const price = Number(data.price); const eps = Number(data.eps); // Graham Intrinsic Value Formula const intrinsicValue = eps * (8.5 + 2 * growth); // Fair value gap const fairValueGap = ((intrinsicValue - price) / price) * 100; // Update UI document.getElementById("price").innerText = price.toFixed(2); document.getElementById("eps").innerText = eps.toFixed(2); document.getElementById("iv").innerText = intrinsicValue.toFixed(2); document.getElementById("gap").innerText = fairValueGap.toFixed(2); // Buy / Hold / Sell Signal let signal = "HOLD"; if (fairValueGap > 20) signal = "BUY"; if (fairValueGap < -20) signal = "SELL"; document.getElementById("signal").innerText = signal; } catch (error) { console.error(error); alert("Something went wrong. Please try again later."); } }
