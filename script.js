async function calc() { const symbol = document.getElementById("stock").value; const growthInput = document.getElementById("growth").value; const growth = growthInput ? Number(growthInput) : 10; try { const response = await fetch(`/api/stock?symbol=${symbol}`); if (!response.ok) { alert("Server error while fetching stock data"); return; } const data = await response.json(); if (data.error) { alert(data.error); return; } if (!data.eps || data.eps === 0) { alert("EPS data not available for this stock"); return; } const price = Number(data.price); const eps = Number(data.eps); const intrinsicValue = eps * (8.5 + 2 * growth); const fairValueGap = ((intrinsicValue - price) / price) * 100; document.getElementById("price").innerText = price.toFixed(2); document.getElementById("eps").innerText = eps.toFixed(2); document.getElementById("iv").innerText = intrinsicValue.toFixed(2); document.getElementById("gap").innerText = fairValueGap.toFixed(2); let signal = "HOLD"; if (fairValueGap > 20) signal = "BUY"; if (fairValueGap < -20) signal = "SELL"; document.getElementById("signal").innerText = signal; } catch (err) { console.error(err); alert("Unexpected error occurred"); } }
