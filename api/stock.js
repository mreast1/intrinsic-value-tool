import fetch from "node-fetch"; export default async function handler(req, res) { res.setHeader("Access-Control-Allow-Origin", "*"); const symbol = req.query.symbol; if (!symbol) { return res.status(400).json({ error: "Symbol is required" }); } try { const url = `https://www.screener.in/company/${symbol}/`; const response = await fetch(url, { headers: { "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36", "Accept": "text/html", }, }); if (!response.ok) { return res.status(500).json({ error: "Failed to fetch Screener.in" }); } const html = await response.text(); // Extract EPS from the embedded JSON const epsMatch = html.match(/"eps":"([\d.]+)"/); if (!epsMatch) { return res.status(404).json({ error: "EPS not found on Screener.in" }); } const eps = parseFloat(epsMatch[1]); // Extract Market Price (from "currentPrice" in JSON or fallback) const priceMatch = html.match(/"currentPrice":([\d.]+)/); const price = priceMatch ? parseFloat(priceMatch[1]) : 0; res.status(200).json({ eps, price }); } catch (err) { res.status(500).json({ error: "Server error", message: err.message }); } }
