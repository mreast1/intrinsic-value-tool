import fetch from "node-fetch"; export default async function handler(req, res) { res.setHeader("Access-Control-Allow-Origin", "*"); const symbol = req.query.symbol; if (!symbol) { return res.status(400).json({ error: "Symbol is required" }); } try { const url = `https://www.screener.in/company/${symbol}/`; const response = await fetch(url, { headers: { "User-Agent": "Mozilla/5.0", "Accept": "text/html", }, }); if (!response.ok) { return res.status(500).json({ error: "Failed to fetch Screener.in" }); } const html = await response.text(); // Extract the JSON safely const jsonMatch = html.match(/window\.__DATA__\s*=\s*(\{.*\});/); if (!jsonMatch) { return res.status(404).json({ error: "Screener JSON not found" }); } const jsonData = JSON.parse(jsonMatch[1]); // Navigate to EPS and price const fundamentals = jsonData?.company?.stats || {}; const eps = parseFloat(fundamentals.eps) || 0; const price = parseFloat(fundamentals.current_price) || 0; if (!eps) { return res.status(404).json({ error: "EPS not found" }); } res.status(200).json({ eps, price }); } catch (err) { console.error(err); res.status(500).json({ error: "Server error", message: err.message }); } }
